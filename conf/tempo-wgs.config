//
// These should just be the options that do
// _not_ depend on the cluster but the which
// pipeline we are running: wes vs wgs
//
// WGS specific options
//
// This one is hard coded with IRIS specific limits
//

params {
    max_records_in_ram = "5000000" 
}

process {

  time = { task.attempt < 3 ? 48.h * task.attempt  : 167.h }

  // RunMutect2 is hard coded to take 8Gb in `-Xmx8g`
  // 1 cpu for mutect and and 1 for singularity
  //
  // Also add some resources on subsequent attempts
  // to help if the program is congestion
  //
  withName:RunMutect2 {
    cpus = { 2 + 1 * task.attempt }
    memory = { 10.GB + 5.GB * task.attempt }
  }
  
  withName:SomaticCombineMutect2Vcf {
    cpus = { 1 + 1 * task.attempt }
    memory = { 2.GB + 2.GB * task.attempt }
  }

  withLabel:multiqc_process { // SampleRunMultiQC , SomaticRunMultiQC , CohortRunMultiQC
    cpus = { 4 + 12 * task.attempt }
    memory = { 34.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: SomaticRunSVclone {
    cpus = { 4 + 12 * task.attempt }
    memory = { 34.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName:SomaticAnnotateMaf {
    cpus = { 4 + 12 * task.attempt }
    memory = { 34.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName:SomaticFacetsAnnotation {
    cpus = { 4 + 12 * task.attempt }
    memory = { 34.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName:RunPolysolver {
    cpus = { 8 }
    memory = { 16.GB * task.attempt }
  }

  withName:QcQualimap {
    cpus = { 4 * task.attempt }
    memory = { 128.GB * task.attempt }
  }

  withName: '.*RunSvABA' {
    cpus = { 4 + 12 * task.attempt }
    memory = { 34.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName:RunLOHHLA {
    cpus = { 4 + 12 * task.attempt }
    memory = { 34.GB * task.attempt }
    time = { task.attempt < 3 ? 6.h * task.attempt  : 24.h }
  }

  //
  // Default SLURM config
  //

  withName: SomaticDellyCall {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: 'runBRASS.+' {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: runBRASS {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: SomaticRunManta {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: SomaticCombineChannel {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: RunMsiSensor {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: RunMutationSignatures {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: RunNeoantigen {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: MetaDataParser {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: HRDetect {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

  withName: CohortRunMultiQC {
    cpus = { 4 + 12 * task.attempt } // 16,28,40,52
    memory = { 249.GB * task.attempt }
    time = { task.attempt < 3 ? 30.h * task.attempt : 167.h }
  }

}
